https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhQi-z-VyFmTZMTPOSkiWZV9pR7i6gYSZOa7D5qt9y4B_fNM9gNk8YnTu6X6GgRg95Fh1nuT1vh5Zn7G0srvWv1u0XO2W9y43b87QnqamUbNR8zYdOODkw8ZGO2AaKu5DOHUUANikOldLbymADqtCZ2t2nSC2TOlFydROZrnHLu7iFyEweqEqEuUlcPSk3XJmIGne3Y0qV2GCPKJjeyP2E24I1U4Mp1kcdQEw71qNjvafq0PZI5_wJ9wteMLICjDr396DtvqjhNdMZ6mUK_zXaqXy9NQg&lib=MTi0nYXdyytobySZgRPzphdiqu7X8nZNK

<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Anggaran Tuntutan Perjalanan - JPN Pahang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
        @media print {
            .no-print { display: none; }
            .print-only { display: block; }
            body { background: white; padding: 0; }
            .container-main { box-shadow: none; border: none; width: 100%; max-width: 100%; margin: 0; }
        }
        .uppercase-input { text-transform: uppercase; }
        .btn-saving { opacity: 0.5; pointer-events: none; cursor: not-allowed; }
        
        .input-card {
            transition: all 0.3s ease;
            border-left-width: 6px;
        }
        .time-box {
            transition: all 0.2s ease;
            border-width: 2px;
        }
        .time-box:focus-within {
            transform: scale(1.02);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 text-slate-900">

<div class="max-w-7xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200 container-main flex flex-col">
    <!-- Header -->
    <div class="bg-slate-900 p-8 text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full -mr-32 -mt-32 blur-3xl"></div>
        
        <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-emerald-500 rounded-lg shadow-lg shadow-emerald-500/20">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <h1 class="text-3xl font-extrabold tracking-tight">Sistem Anggaran Tuntutan Perjalanan</h1>
                </div>
                <p class="text-slate-400 text-sm font-medium uppercase tracking-widest italic flex items-center gap-2">
                    <span>Versi WP1.4</span>
                    <span class="w-1 h-1 bg-slate-600 rounded-full"></span>
                    <span>Kuat kuasa 1 Jan 2026</span>
                </p>
                <p class="text-[10px] text-slate-500 mt-4 font-semibold uppercase tracking-[0.2em] border-t border-slate-800 pt-3">
                    UNIT INOVASI & JK PBD SEKTOR PEMBELAJARAN, JPN PAHANG
                </p>
            </div>
            <div class="bg-slate-800/80 px-6 py-4 rounded-2xl backdrop-blur-md border border-white/10 text-center min-w-[140px] shadow-xl">
                <p class="text-[10px] uppercase font-bold text-emerald-400 leading-none mb-2">Gred Saraan</p>
                <p class="text-2xl font-black text-white">SSPA</p>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">Tahun 2026</p>
            </div>
        </div>
    </div>

    <div class="p-6 md:p-10 grid grid-cols-1 lg:grid-cols-12 gap-10 bg-slate-50/50">
        <!-- Ruangan Input (Kiri) -->
        <div class="lg:col-span-7 space-y-8 no-print">
            
            <!-- Profil -->
            <div class="input-card bg-white p-6 rounded-2xl border border-slate-200 border-l-blue-600 shadow-md space-y-5">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-blue-50 flex items-center justify-center text-blue-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    </div>
                    <h2 class="text-xl font-extrabold text-slate-800 uppercase tracking-tight">Profil Pegawai</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="space-y-1">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Kod Program</label>
                        <input type="text" id="kod_program" oninput="this.value = this.value.toUpperCase()" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none font-bold text-blue-700 transition-all shadow-sm" placeholder="PBD2026">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">PPD (Negeri Pahang)</label>
                        <select id="ppd_org" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none font-bold text-sm transition-all shadow-sm">
                            <option value="">Sila Pilih PPD</option>
                            <option value="PPD Bentong">PPD Bentong</option>
                            <option value="PPD Bera">PPD Bera</option>
                            <option value="PPD Cameron Highlands">PPD Cameron Highlands</option>
                            <option value="PPD Jerantut">PPD Jerantut</option>
                            <option value="PPD Lipis">PPD Lipis</option>
                            <option value="PPD Kuantan">PPD Kuantan</option>
                            <option value="PPD Maran">PPD Maran</option>
                            <option value="PPD Pekan">PPD Pekan</option>
                            <option value="PPD Raub">PPD Raub</option>
                            <option value="PPD Rompin">PPD Rompin</option>
                            <option value="PPD Temerloh">PPD Temerloh</option>
                            <option value="JPN Pahang">JPN Pahang</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-1">
                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Nama Penuh</label>
                    <input type="text" id="nama" oninput="this.value = this.value.toUpperCase()" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none uppercase-input font-black text-slate-800 transition-all shadow-sm" placeholder="NAMA SEPERTI DALAM KAD PENGENALAN">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="space-y-1">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Gred Kelayakan (SSPA)</label>
                        <select id="gred" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 outline-none text-sm font-bold shadow-sm">
                            <option value="A+" data-makan="115" data-makan-sl="165">Utama / Khas A & Ke Atas</option>
                            <option value="BC" data-makan="100" data-makan-sl="130">Utama / Khas B & C</option>
                            <option value="15" data-makan="85" data-makan-sl="115">Gred 14 & 15</option>
                            <option value="11" data-makan="60" data-makan-sl="80">Gred 11 - 13</option>
                            <option value="9" data-makan="45" data-makan-sl="65">Gred 9 - 10</option>
                            <option value="1" data-makan="40" data-makan-sl="55" selected>Gred 1 - 8</option>
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Mod Kenderaan</label>
                        <select id="jenis_kenderaan" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 outline-none text-sm font-bold shadow-sm">
                            <option value="Kereta">Kereta (90 sen / 80 sen)</option>
                            <option value="Motosikal">Motosikal (60 sen / 50 sen)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Logistik -->
            <div class="input-card bg-white p-6 rounded-2xl border border-slate-200 border-l-amber-500 shadow-md space-y-6">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-amber-50 flex items-center justify-center text-amber-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    </div>
                    <h2 class="text-xl font-extrabold text-slate-800 uppercase tracking-tight">Logistik & Masa</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="space-y-1">
                            <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Lokasi Mula</label>
                            <input type="text" id="asal" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 focus:ring-2 focus:ring-amber-500 focus:bg-white outline-none text-sm transition-all font-medium" placeholder="Rumah / Pejabat">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Lokasi Tamat</label>
                            <input type="text" id="tujuan" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 focus:ring-2 focus:ring-amber-500 focus:bg-white outline-none text-sm transition-all font-medium" placeholder="Destinasi Program">
                        </div>
                        <button onclick="bukaGoogleMaps()" class="w-full py-3 bg-blue-600 text-white rounded-xl text-xs font-black hover:bg-blue-700 transition flex items-center justify-center gap-2 shadow-lg shadow-blue-200 uppercase tracking-widest">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                            Check Jarak di Maps
                        </button>
                    </div>
                    <div class="bg-amber-50 rounded-2xl p-6 border border-amber-100 flex flex-col justify-center items-center text-center shadow-inner">
                        <label class="text-[11px] font-black text-amber-700 uppercase tracking-[0.2em] mb-3">Jarak Sehala (KM)</label>
                        <div class="relative w-full max-w-[160px]">
                            <input type="number" id="jarak" step="0.1" class="w-full bg-white rounded-2xl border-2 border-amber-200 p-4 outline-none font-black text-amber-600 text-4xl text-center focus:border-amber-500 transition-all shadow-md" placeholder="0.0">
                            <span class="absolute -bottom-6 left-0 right-0 text-[10px] text-amber-500 font-black uppercase tracking-tighter">Kilometer</span>
                        </div>
                    </div>
                </div>

                <!-- SEKSYEN MASA YANG LEBIH JELAS -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-6 border-t-2 border-slate-100">
                    <div class="time-box bg-emerald-50 p-4 rounded-2xl border-emerald-200 space-y-2">
                        <label class="text-[12px] font-black text-emerald-700 uppercase tracking-widest flex items-center gap-2">
                            <div class="w-6 h-6 bg-emerald-600 text-white rounded-lg flex items-center justify-center">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            </div>
                            Waktu Bertolak
                        </label>
                        <input type="datetime-local" id="mula_perjalanan" onchange="autoUpdateMalam()" class="w-full rounded-xl border-emerald-200 bg-white p-3 focus:ring-4 focus:ring-emerald-200 outline-none text-sm font-bold text-emerald-900 transition-all shadow-sm">
                        <p class="text-[9px] text-emerald-600 font-bold uppercase tracking-tight italic">Mula keluar dari rumah/pejabat</p>
                    </div>
                    
                    <div class="time-box bg-red-50 p-4 rounded-2xl border-red-200 space-y-2">
                        <label class="text-[12px] font-black text-red-700 uppercase tracking-widest flex items-center gap-2">
                            <div class="w-6 h-6 bg-red-600 text-white rounded-lg flex items-center justify-center">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            </div>
                            Waktu Tiba
                        </label>
                        <input type="datetime-local" id="tamat_perjalanan" onchange="autoUpdateMalam()" class="w-full rounded-xl border-red-200 bg-white p-3 focus:ring-4 focus:ring-red-200 outline-none text-sm font-bold text-red-900 transition-all shadow-sm">
                        <p class="text-[9px] text-red-600 font-bold uppercase tracking-tight italic">Sampai semula di rumah/pejabat</p>
                    </div>
                </div>
            </div>

            <!-- Kos -->
            <div class="input-card bg-white p-6 rounded-2xl border border-slate-200 border-l-indigo-600 shadow-md space-y-5">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-indigo-50 flex items-center justify-center text-indigo-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                    </div>
                    <h2 class="text-xl font-extrabold text-slate-800 uppercase tracking-tight">Makan & Penginapan</h2>
                </div>
                
                <div class="grid grid-cols-3 gap-4">
                    <label class="flex flex-col items-center p-4 bg-slate-50 rounded-2xl border-2 border-transparent cursor-pointer hover:bg-indigo-50 transition-all has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-50 shadow-sm">
                        <input type="checkbox" id="makan_pagi" class="w-6 h-6 accent-indigo-600">
                        <span class="text-[10px] font-black mt-3 text-slate-500 uppercase">Sarapan</span>
                    </label>
                    <label class="flex flex-col items-center p-4 bg-slate-50 rounded-2xl border-2 border-transparent cursor-pointer hover:bg-indigo-50 transition-all has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-50 shadow-sm">
                        <input type="checkbox" id="makan_tengahari" class="w-6 h-6 accent-indigo-600">
                        <span class="text-[10px] font-black mt-3 text-slate-500 uppercase text-center">T. Hari</span>
                    </label>
                    <label class="flex flex-col items-center p-4 bg-slate-50 rounded-2xl border-2 border-transparent cursor-pointer hover:bg-indigo-50 transition-all has-[:checked]:border-indigo-500 has-[:checked]:bg-indigo-50 shadow-sm">
                        <input type="checkbox" id="makan_malam" class="w-6 h-6 accent-indigo-600">
                        <span class="text-[10px] font-black mt-3 text-slate-500 uppercase">Malam</span>
                    </label>
                </div>

                <div class="grid grid-cols-3 gap-5 pt-4 border-t border-slate-100">
                    <div class="space-y-1 text-center">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Bil. Malam</label>
                        <input type="number" id="bil_malam" value="0" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 font-black text-indigo-700 text-center focus:bg-white transition-all outline-none shadow-sm">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Kadar Hotel</label>
                        <input type="number" id="hotel_kadar" value="0" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 font-bold focus:bg-white transition-all outline-none shadow-sm text-center" placeholder="RM">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[11px] font-black text-slate-400 uppercase tracking-wider">Tol (RM)</label>
                        <input type="number" id="tol" value="0" class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 font-bold focus:bg-white transition-all outline-none shadow-sm text-center" placeholder="0.00">
                    </div>
                </div>
                <div class="flex items-center gap-3 p-4 bg-indigo-50/80 rounded-2xl border border-indigo-100 shadow-sm">
                    <input type="checkbox" id="is_lojing" class="w-5 h-5 accent-indigo-600">
                    <label for="is_lojing" class="text-xs font-black text-indigo-800 uppercase italic tracking-tighter">Guna Kadar Lojing (WP1.4 2026)</label>
                </div>
                <select id="wilayah" class="hidden"><option value="Sem">Sem</option></select>
            </div>

            <button onclick="kiraTNT()" class="w-full bg-slate-900 hover:bg-black text-white font-black py-6 rounded-[2rem] transition-all duration-300 shadow-2xl active:scale-95 text-xl uppercase tracking-[0.3em] ring-offset-4 focus:ring-4 focus:ring-emerald-500 shadow-emerald-900/10">
                PROSES ANGGARAN
            </button>
        </div>

        <!-- Bahagian Hasil (Kanan) -->
        <div class="lg:col-span-5">
            <div id="result_container" class="bg-slate-800 p-8 rounded-[3.5rem] shadow-2xl h-full flex flex-col items-center justify-center text-center relative overflow-hidden sticky top-8">
                <div class="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10 pointer-events-none"></div>
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 to-blue-500"></div>
                
                <div id="welcome_msg" class="space-y-8 relative z-10">
                    <div class="bg-white/5 p-10 rounded-full w-40 h-40 mx-auto flex items-center justify-center backdrop-blur-3xl border border-white/10 shadow-2xl">
                        <svg class="w-20 h-20 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <div>
                        <p class="text-2xl font-black text-white uppercase tracking-[0.2em]">Analisis Aktif</p>
                        <p class="text-slate-400 text-sm mt-3 max-w-[280px] mx-auto leading-relaxed italic font-medium">Sila lengkapkan butiran logistik dan masa bertolak/tiba untuk melihat ringkasan.</p>
                    </div>
                </div>

                <div id="actual_result" class="hidden w-full space-y-8 text-left relative z-10">
                    <div class="text-center border-b border-white/10 pb-8">
                        <h3 class="text-[10px] font-black text-emerald-400 tracking-[0.5em] uppercase mb-4">Ringkasan Penyata</h3>
                        <p class="text-3xl font-black text-white leading-tight uppercase tracking-tight" id="res_nama_pegawai">-</p>
                        <p class="text-xs font-black text-slate-500 mt-2 tracking-[0.2em] uppercase" id="res_ppd_info"></p>
                        <div class="mt-6 inline-flex px-6 py-2 bg-emerald-500 text-emerald-950 text-[10px] font-black rounded-full uppercase tracking-widest border border-white/20 shadow-xl shadow-emerald-500/20" id="res_kod_program">-</div>
                    </div>

                    <div class="grid grid-cols-1 gap-4">
                        <div class="flex justify-between items-center p-6 bg-white/5 rounded-[2rem] border border-white/10 backdrop-blur-sm shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">Mileage Perjalanan</span>
                                <span class="text-base font-black text-white tracking-wide" id="res_km_stats">0 KM</span>
                            </div>
                            <span class="text-3xl font-black text-emerald-400" id="val_km">RM 0.00</span>
                        </div>

                        <div class="flex justify-between items-center p-6 bg-white/5 rounded-[2rem] border border-white/10 backdrop-blur-sm shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1">Elaun Makan/Harian</span>
                                <span class="text-xs font-black text-white/50 italic" id="label_elaun">-</span>
                            </div>
                            <span class="text-3xl font-black text-emerald-400" id="val_elaun">RM 0.00</span>
                        </div>

                        <div class="flex justify-between items-center p-6 bg-white/5 rounded-[2rem] border border-white/10 backdrop-blur-sm shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-500 uppercase tracking-[0.2em] mb-1" id="label_penginapan">Hotel & Tol</span>
                                <span class="text-xs font-black text-white/50 italic" id="res_hotel_info">-</span>
                            </div>
                            <span class="text-3xl font-black text-emerald-400" id="val_lain">RM 0.00</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-emerald-600 to-teal-700 rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden text-center ring-4 ring-white/10">
                        <p class="text-white/60 text-[10px] font-black uppercase tracking-[0.5em] mb-3">Anggaran Tuntutan Kasar</p>
                        <p class="text-6xl font-black tracking-tighter" id="val_total">RM 0.00</p>
                        <div class="absolute -right-6 -bottom-6 w-32 h-32 bg-white/10 rounded-full blur-3xl"></div>
                    </div>

                    <div class="space-y-4 no-print pt-4">
                        <button id="btn_save" onclick="simpanKeSheet()" class="w-full bg-emerald-500 hover:bg-emerald-400 text-emerald-950 font-black py-5 rounded-3xl transition-all shadow-2xl shadow-emerald-500/20 flex items-center justify-center gap-4 text-sm uppercase tracking-[0.2em]">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
                            Simpan Maklumat
                        </button>
                        <button onclick="window.print()" class="w-full bg-white/5 hover:bg-white/10 text-white border border-white/10 py-4 rounded-3xl text-[10px] font-black tracking-[0.3em] transition flex items-center justify-center gap-2 uppercase">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4H7v4a2 2 0 002 2zM9 9V5a2 2 0 012-2h2a2 2 0 012 2v4M7 9h10"/></svg>
                            Cetak Ringkasan
                        </button>
                    </div>
                    
                    <div id="status_msg" class="text-[10px] text-center font-black text-emerald-400 hidden py-4 bg-white/5 rounded-3xl border border-white/10 uppercase tracking-[0.3em] animate-pulse">Menghantar Data...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhQi-z-VyFmTZMTPOSkiWZV9pR7i6gYSZOa7D5qt9y4B_fNM9gNk8YnTu6X6GgRg95Fh1nuT1vh5Zn7G0srvWv1u0XO2W9y43b87QnqamUbNR8zYdOODkw8ZGO2AaKu5DOHUUANikOldLbymADqtCZ2t2nSC2TOlFydROZrnHLu7iFyEweqEqEuUlcPSk3XJmIGne3Y0qV2GCPKJjeyP2E24I1U4Mp1kcdQEw71qNjvafq0PZI5_wJ9wteMLICjDr396DtvqjhNdMZ6mUK_zXaqXy9NQg&lib=MTi0nYXdyytobySZgRPzphdiqu7X8nZNK
";

    let currentData = null;

    function bukaGoogleMaps() {
        const asal = document.getElementById('asal').value;
        const tujuan = document.getElementById('tujuan').value;
        if (!asal || !tujuan) { alert("Sila isi lokasi 'Dari' dan 'Ke'."); return; }
        window.open(`https://www.google.com/maps/dir/${encodeURIComponent(asal)}/${encodeURIComponent(tujuan)}`, '_blank');
    }

    function autoUpdateMalam() {
        const mulaVal = document.getElementById('mula_perjalanan').value;
        const tamatVal = document.getElementById('tamat_perjalanan').value;
        if (mulaVal && tamatVal) {
            const mula = new Date(mulaVal);
            const tamat = new Date(tamatVal);
            if (!isNaN(mula) && !isNaN(tamat)) {
                const diffHours = (tamat - mula) / (1000 * 60 * 60);
                document.getElementById('bil_malam').value = diffHours >= 24 ? Math.floor(diffHours / 24) : 0;
            }
        }
    }

    function formatMasa(date) {
        if (!date || isNaN(date.getTime())) return "-";
        return date.toLocaleString('ms-MY', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', hour12:true }).toUpperCase();
    }

    function kiraTNT() {
        const el = (id) => document.getElementById(id);
        const mulaVal = el('mula_perjalanan').value;
        const tamatVal = el('tamat_perjalanan').value;

        if (!mulaVal || !tamatVal) { alert("Sila isi masa bertolak/tiba."); return; }
        const mula = new Date(mulaVal);
        const tamat = new Date(tamatVal);
        const diffHours = (tamat - mula) / (1000 * 60 * 60);
        if (diffHours < 0) { alert("Waktu Tiba mestilah selepas Waktu Bertolak."); return; }

        const sehalaKM = parseFloat(el('jarak').value) || 0;
        const totalKM = sehalaKM * 2;
        
        let kosKM = 0;
        if (el('jenis_kenderaan').value === "Kereta") {
            kosKM = totalKM <= 500 ? totalKM * 0.90 : (500 * 0.90) + ((totalKM - 500) * 0.80);
        } else {
            kosKM = totalKM <= 500 ? totalKM * 0.60 : (500 * 0.60) + ((totalKM - 500) * 0.50);
        }

        const gred = el('gred');
        const wilayah = el('wilayah').value;
        const baseMakan = wilayah === "Sem" ? parseFloat(gred.options[gred.selectedIndex].dataset.makan) : parseFloat(gred.options[gred.selectedIndex].dataset.makanSl);

        let deduction = (el('makan_pagi').checked ? 0.2 : 0) + (el('makan_tengahari').checked ? 0.4 : 0) + (el('makan_malam').checked ? 0.4 : 0);

        let elaunTotal = 0, labelElaun = "";
        if (diffHours >= 24) {
            const hari = Math.floor(diffHours / 24);
            elaunTotal = hari * (baseMakan * (1 - deduction));
            labelElaun = `${hari} Hari Makan`;
            if (diffHours % 24 > 8) { elaunTotal += (baseMakan / 2); labelElaun += " + Harian"; }
        } else if (diffHours > 8) {
            elaunTotal = baseMakan / 2;
            labelElaun = "Elaun Harian";
        } else { labelElaun = "Tiada Elaun"; }

        const bilMalam = parseInt(el('bil_malam').value) || 0;
        let kosHotelFinal = el('is_lojing').checked ? 100 * bilMalam : (parseFloat(el('hotel_kadar').value) || 0) * bilMalam;
        const tolVal = parseFloat(el('tol').value) || 0;
        
        el('welcome_msg').classList.add('hidden');
        el('actual_result').classList.remove('hidden');
        el('res_nama_pegawai').innerText = el('nama').value || "PEGAWAI";
        el('res_ppd_info').innerText = el('ppd_org').value || "NEG. PAHANG";
        el('res_kod_program').innerText = "PROGRAM: " + (el('kod_program').value || "UMUM");
        el('val_km').innerText = `RM ${kosKM.toFixed(2)}`;
        el('res_km_stats').innerText = `${totalKM.toFixed(1)} KM (P-B)`;
        el('label_elaun').innerText = labelElaun;
        el('val_elaun').innerText = `RM ${elaunTotal.toFixed(2)}`;
        el('val_lain').innerText = `RM ${(kosHotelFinal + tolVal).toFixed(2)}`;
        const finalSum = kosKM + elaunTotal + kosHotelFinal + tolVal;
        el('val_total').innerText = `RM ${finalSum.toFixed(2)}`;

        currentData = {
            kodProgram: el('kod_program').value || "UMUM",
            nama: el('nama').value.toUpperCase(),
            ppd: el('ppd_org').value,
            perjalanan: `${(el('asal').value || "ASAL").toUpperCase()} ➔ ${(el('tujuan').value || "DESTINASI").toUpperCase()}`,
            mula: formatMasa(mula),
            tamat: formatMasa(tamat),
            jumlahKM: totalKM.toFixed(1),
            kosKM: kosKM.toFixed(2),
            elaunMakan: elaunTotal.toFixed(2),
            kosHotel: kosHotelFinal.toFixed(2),
            tol: tolVal.toFixed(2),
            jumlahBesar: finalSum.toFixed(2)
        };
    }

    function simpanKeSheet() {
        if (!currentData) return;
        if (SCRIPT_URL.includes("MASUKKAN")) { alert("Sila kemaskini SCRIPT_URL dahulu."); return; }
        const btn = document.getElementById('btn_save');
        const status = document.getElementById('status_msg');
        btn.classList.add('btn-saving');
        status.innerText = "SEDANG BERHUBUNG...";
        status.classList.remove('hidden');

        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(currentData)
        })
        .then(() => {
            status.innerText = "✓ DATA BERJAYA DIHANTAR!";
            btn.classList.remove('btn-saving');
            setTimeout(() => status.classList.add('hidden'), 5000);
        })
        .catch(err => {
            status.innerText = "❌ RALAT: " + err;
            btn.classList.remove('btn-saving');
        });
    }
</script>
</body>
</html>
