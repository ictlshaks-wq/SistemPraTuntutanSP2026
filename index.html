<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Anggaran Tuntutan Perjalanan - JPN Pahang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
        @media print {
            .no-print { display: none; }
            .print-only { display: block; }
            body { background: white; padding: 0; }
            .container-main { box-shadow: none; border: none; width: 100%; max-width: 100%; margin: 0; }
        }
        .uppercase-input { text-transform: uppercase; }
        .input-card { transition: all 0.3s ease; border-left-width: 6px; }
        .btn-primary { transition: all 0.2s ease; }
        .btn-primary:active { transform: scale(0.95); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 text-slate-900">

<div class="max-w-7xl mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200 container-main flex flex-col">
    
    <!-- Header Section -->
    <div class="bg-slate-900 p-8 text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full -mr-32 -mt-32 blur-3xl"></div>
        <div class="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-emerald-500 rounded-lg shadow-lg">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Sistem Anggaran Tuntutan Perjalanan</h1>
                </div>
                <p class="text-slate-400 text-sm font-medium uppercase tracking-widest italic">Versi WP1.4 • Kuat kuasa 1 Jan 2026</p>
                <p class="text-[10px] text-slate-500 mt-4 font-bold uppercase tracking-[0.2em] border-t border-slate-800 pt-3">
                    UNIT INOVASI & JK PBD SEKTOR PEMBELAJARAN, JPN PAHANG 2026
                </p>
            </div>
            <div class="bg-slate-800/80 px-6 py-4 rounded-2xl border border-white/10 text-center min-w-[140px] shadow-xl">
                <p class="text-[10px] uppercase font-bold text-emerald-400 leading-none mb-1">Gred Kelayakan</p>
                <p class="text-2xl font-black text-white">SSPA</p>
            </div>
        </div>
    </div>

    <div class="p-6 md:p-10 grid grid-cols-1 lg:grid-cols-12 gap-10 bg-slate-50/50">
        
        <!-- Input Form (Left) -->
        <div class="lg:col-span-7 space-y-8 no-print">
            
            <!-- Profile Section (Blue) -->
            <div class="input-card bg-white p-6 rounded-2xl border border-slate-200 border-l-blue-600 shadow-sm space-y-4">
                <h2 class="text-lg font-extrabold text-blue-800 uppercase flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    Profil & Gred
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Kod Program</label>
                        <input type="text" id="kod_program" oninput="this.value = this.value.toUpperCase()" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-700" placeholder="PBD2026">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-wider">PPD Pahang</label>
                        <select id="ppd_org" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 focus:ring-2 focus:ring-blue-500 outline-none font-bold text-sm">
                            <option value="">Sila Pilih PPD</option>
                            <option value="PPD Bentong">PPD Bentong</option>
                            <option value="PPD Bera">PPD Bera</option>
                            <option value="PPD Cameron Highlands">PPD Cameron Highlands</option>
                            <option value="PPD Jerantut">PPD Jerantut</option>
                            <option value="PPD Lipis">PPD Lipis</option>
                            <option value="PPD Kuantan">PPD Kuantan</option>
                            <option value="PPD Maran">PPD Maran</option>
                            <option value="PPD Pekan">PPD Pekan</option>
                            <option value="PPD Raub">PPD Raub</option>
                            <option value="PPD Rompin">PPD Rompin</option>
                            <option value="PPD Temerloh">PPD Temerloh</option>
                            <option value="JPN Pahang">JPN Pahang</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Nama Pegawai</label>
                    <input type="text" id="nama" oninput="this.value = this.value.toUpperCase()" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 focus:ring-2 focus:ring-blue-500 outline-none font-bold text-slate-800" placeholder="NAMA PENUH">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Gred SSPA</label>
                        <select id="gred" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 outline-none font-bold text-sm">
                            <option value="A+" data-makan="115" data-makan-sl="165">A & Ke Atas</option>
                            <option value="BC" data-makan="100" data-makan-sl="130">B & C</option>
                            <option value="15" data-makan="85" data-makan-sl="115">Gred 14 - 15</option>
                            <option value="11" data-makan="60" data-makan-sl="80">Gred 11 - 13</option>
                            <option value="9" data-makan="45" data-makan-sl="65">Gred 9 - 10</option>
                            <option value="1" data-makan="40" data-makan-sl="55" selected>Gred 1 - 8</option>
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-wider">Kenderaan</label>
                        <select id="jenis_kenderaan" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 outline-none font-bold text-sm">
                            <option value="Kereta">Kereta (90s / 80s)</option>
                            <option value="Motosikal">Motosikal (60s / 50s)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Logistics Section (Amber) -->
            <div class="input-card bg-white p-6 rounded-2xl border border-slate-200 border-l-amber-500 shadow-sm space-y-6">
                <h2 class="text-lg font-extrabold text-amber-800 uppercase flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                    Logistik & Masa
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <input type="text" id="asal" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 outline-none text-sm font-bold" placeholder="Lokasi Mula">
                        <input type="text" id="tujuan" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2.5 outline-none text-sm font-bold" placeholder="Destinasi">
                        <button onclick="bukaGoogleMaps()" class="btn-primary w-full py-2.5 bg-blue-600 text-white rounded-xl text-[10px] font-black hover:bg-blue-700 uppercase tracking-widest shadow-md">
                            Cari Jarak di Maps
                        </button>
                    </div>
                    <div class="bg-amber-50 rounded-2xl p-4 border border-amber-100 flex flex-col justify-center items-center text-center">
                        <label class="text-[10px] font-black text-amber-700 uppercase mb-2 tracking-widest">Jarak Sehala (KM)</label>
                        <input type="number" id="jarak" step="0.1" class="w-24 bg-white rounded-xl border-2 border-amber-200 p-2 outline-none font-black text-amber-600 text-2xl text-center shadow-inner" placeholder="0.0">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t pt-4">
                    <div class="bg-emerald-50 p-3 rounded-xl border border-emerald-100">
                        <label class="text-[10px] font-black text-emerald-700 uppercase block mb-1">Masa Bertolak</label>
                        <input type="datetime-local" id="mula_perjalanan" onchange="autoUpdateMalam()" class="w-full bg-white rounded-lg p-2 text-xs font-bold border-none outline-none">
                    </div>
                    <div class="bg-red-50 p-3 rounded-xl border border-red-100">
                        <label class="text-[10px] font-black text-red-700 uppercase block mb-1">Masa Tiba</label>
                        <input type="datetime-local" id="tamat_perjalanan" onchange="autoUpdateMalam()" class="w-full bg-white rounded-lg p-2 text-xs font-bold border-none outline-none">
                    </div>
                </div>
            </div>

            <!-- Cost Section (Indigo) -->
            <div class="input-card bg-white p-6 rounded-2xl border border-slate-200 border-l-indigo-600 shadow-sm space-y-4">
                <h2 class="text-lg font-extrabold text-indigo-800 uppercase">Hotel & Makan</h2>
                <div class="grid grid-cols-3 gap-2">
                    <label class="flex flex-col items-center p-3 bg-slate-50 rounded-xl border border-slate-200 cursor-pointer text-center">
                        <input type="checkbox" id="makan_pagi" class="w-4 h-4 accent-indigo-600">
                        <span class="text-[9px] font-bold mt-1 text-slate-500 uppercase">Sarapan</span>
                    </label>
                    <label class="flex flex-col items-center p-3 bg-slate-50 rounded-xl border border-slate-200 cursor-pointer text-center">
                        <input type="checkbox" id="makan_tengahari" class="w-4 h-4 accent-indigo-600">
                        <span class="text-[9px] font-bold mt-1 text-slate-500 uppercase">T. Hari</span>
                    </label>
                    <label class="flex flex-col items-center p-3 bg-slate-50 rounded-xl border border-slate-200 cursor-pointer text-center">
                        <input type="checkbox" id="makan_malam" class="w-4 h-4 accent-indigo-600">
                        <span class="text-[9px] font-bold mt-1 text-slate-500 uppercase">Malam</span>
                    </label>
                </div>
                <div class="grid grid-cols-3 gap-4 pt-2">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase block mb-1">Malam</label>
                        <input type="number" id="bil_malam" value="0" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2 font-bold text-indigo-700 text-center">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase block mb-1">Kadar Hotel</label>
                        <input type="number" id="hotel_kadar" value="0" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2 font-bold text-center">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase block mb-1">Tol (RM)</label>
                        <input type="number" id="tol" value="0" class="w-full rounded-xl border-slate-200 bg-slate-50 p-2 font-bold text-center">
                    </div>
                </div>
                <div class="flex items-center gap-3 p-3 bg-indigo-50 rounded-xl border border-indigo-100">
                    <input type="checkbox" id="is_lojing" class="w-5 h-5 accent-indigo-600">
                    <label for="is_lojing" class="text-[11px] font-black text-indigo-800 uppercase italic">Guna Kadar Lojing (WP1.4 2026)</label>
                </div>
                <!-- Hidden Select for Calculation Logic -->
                <select id="wilayah" class="hidden"><option value="Sem">Sem</option></select>
            </div>

            <button onclick="kiraTNT()" class="btn-primary w-full bg-slate-900 hover:bg-black text-white font-black py-6 rounded-[2rem] shadow-2xl active:scale-95 text-xl uppercase tracking-[0.3em] ring-offset-2 focus:ring-4 focus:ring-emerald-500">
                PROSES ANGGARAN
            </button>
        </div>

        <!-- Result Card (Right) -->
        <div class="lg:col-span-5">
            <div id="result_container" class="bg-slate-800 p-8 rounded-[3.5rem] shadow-2xl h-full flex flex-col items-center justify-center text-center relative overflow-hidden sticky top-8">
                <div class="absolute top-0 right-0 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10 pointer-events-none"></div>
                
                <div id="welcome_msg" class="space-y-6 relative z-10">
                    <div class="bg-white/5 p-8 rounded-full w-32 h-32 mx-auto flex items-center justify-center backdrop-blur-3xl border border-white/10">
                        <svg class="w-16 h-16 text-emerald-400 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    </div>
                    <p class="text-xl font-bold text-white uppercase tracking-widest">Sedia Diproses</p>
                </div>

                <div id="actual_result" class="hidden w-full space-y-6 text-left relative z-10">
                    <div class="text-center border-b border-white/10 pb-6">
                        <h3 class="text-[10px] font-black text-emerald-400 tracking-[0.5em] uppercase mb-4">Ringkasan Penyata</h3>
                        <p class="text-3xl font-black text-white leading-tight uppercase" id="res_nama_pegawai">-</p>
                        <p class="text-[11px] font-black text-slate-500 mt-2 tracking-[0.2em] uppercase" id="res_ppd_info"></p>
                        <div class="mt-5 inline-flex px-5 py-1.5 bg-emerald-500 text-emerald-950 text-[10px] font-black rounded-full uppercase" id="res_kod_program">-</div>
                    </div>

                    <div class="grid grid-cols-1 gap-3">
                        <div class="flex justify-between items-center p-5 bg-white/5 rounded-[2rem] border border-white/10 shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Mileage (KM)</span>
                                <span class="text-base font-black text-white" id="res_km_stats">0 KM</span>
                            </div>
                            <span class="text-2xl font-black text-emerald-400" id="val_km">RM 0.00</span>
                        </div>

                        <div class="flex justify-between items-center p-5 bg-white/5 rounded-[2rem] border border-white/10 shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Elaun Makan</span>
                                <span class="text-xs font-bold text-white/50" id="label_elaun">-</span>
                            </div>
                            <span class="text-2xl font-black text-emerald-400" id="val_elaun">RM 0.00</span>
                        </div>

                        <div class="flex justify-between items-center p-5 bg-white/5 rounded-[2rem] border border-white/10 shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-[9px] font-black text-slate-500 uppercase tracking-widest">Hotel & Tol</span>
                                <span class="text-xs font-bold text-white/50" id="res_hotel_info">-</span>
                            </div>
                            <span class="text-2xl font-black text-emerald-400" id="val_lain">RM 0.00</span>
                        </div>
                    </div>

                    <div class="bg-gradient-to-br from-emerald-600 to-teal-700 rounded-[3rem] p-10 text-white shadow-2xl relative overflow-hidden text-center ring-4 ring-white/10">
                        <p class="text-white/60 text-[10px] font-black uppercase tracking-[0.5em] mb-2">Jumlah Anggaran Kasar</p>
                        <p class="text-6xl font-black tracking-tighter" id="val_total">RM 0.00</p>
                    </div>

                    <div class="space-y-3 no-print pt-2">
                        <button id="btn_save" onclick="simpanKeSheet()" class="btn-primary w-full bg-emerald-500 hover:bg-emerald-400 text-emerald-950 font-black py-4 rounded-2xl shadow-xl flex items-center justify-center gap-3 text-sm uppercase tracking-widest transition-all">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/></svg>
                            Hantar ke Sheet
                        </button>
                        <button onclick="window.print()" class="w-full bg-white/5 hover:bg-white/10 text-white border border-white/10 py-3 rounded-2xl text-[10px] font-black tracking-widest transition flex items-center justify-center gap-2 uppercase">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4H7v4a2 2 0 002 2zM9 9V5a2 2 0 012-2h2a2 2 0 012 2v4M7 9h10"/></svg>
                            Cetak
                        </button>
                    </div>
                    
                    <div id="status_msg" class="text-[10px] text-center font-black text-emerald-400 hidden py-2 uppercase animate-pulse tracking-widest">Hantar Data...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // MASUKKAN URL GOOGLE SCRIPT ANDA DI SINI
    const SCRIPT_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhQi-z-VyFmTZMTPOSkiWZV9pR7i6gYSZOa7D5qt9y4B_fNM9gNk8YnTu6X6GgRg95Fh1nuT1vh5Zn7G0srvWv1u0XO2W9y43b87QnqamUbNR8zYdOODkw8ZGO2AaKu5DOHUUANikOldLbymADqtCZ2t2nSC2TOlFydROZrnHLu7iFyEweqEqEuUlcPSk3XJmIGne3Y0qV2GCPKJjeyP2E24I1U4Mp1kcdQEw71qNjvafq0PZI5_wJ9wteMLICjDr396DtvqjhNdMZ6mUK_zXaqXy9NQg&lib=MTi0nYXdyytobySZgRPzphdiqu7X8nZNK";

    let currentData = null;

    function bukaGoogleMaps() {
        const asal = document.getElementById('asal').value;
        const tujuan = document.getElementById('tujuan').value;
        if (!asal || !tujuan) { alert("Sila isi lokasi 'Dari' dan 'Ke'."); return; }
        window.open(`https://www.google.com/maps/dir/${encodeURIComponent(asal)}/${encodeURIComponent(tujuan)}`, '_blank');
    }

    function autoUpdateMalam() {
        const mulaVal = document.getElementById('mula_perjalanan').value;
        const tamatVal = document.getElementById('tamat_perjalanan').value;
        if (mulaVal && tamatVal) {
            const mula = new Date(mulaVal);
            const tamat = new Date(tamatVal);
            if (!isNaN(mula) && !isNaN(tamat)) {
                const diffHours = (tamat - mula) / (1000 * 60 * 60);
                document.getElementById('bil_malam').value = diffHours >= 24 ? Math.floor(diffHours / 24) : 0;
            }
        }
    }

    function formatMasa(date) {
        if (!date || isNaN(date.getTime())) return "-";
        return date.toLocaleString('ms-MY', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', hour12:true }).toUpperCase();
    }

    function kiraTNT() {
        const el = (id) => document.getElementById(id);
        const mulaVal = el('mula_perjalanan').value;
        const tamatVal = el('tamat_perjalanan').value;

        if (!mulaVal || !tamatVal) { alert("Sila isi masa bertolak/tiba."); return; }
        const mula = new Date(mulaVal);
        const tamat = new Date(tamatVal);
        const diffHours = (tamat - mula) / (1000 * 60 * 60);
        if (diffHours < 0) { alert("Waktu Tiba mestilah selepas Waktu Bertolak."); return; }

        // Mileage Calculation
        const totalKM = (parseFloat(el('jarak').value) || 0) * 2;
        let kosKM = 0;
        if (el('jenis_kenderaan').value === "Kereta") {
            kosKM = totalKM <= 500 ? totalKM * 0.90 : (500 * 0.90) + ((totalKM - 500) * 0.80);
        } else {
            kosKM = totalKM <= 500 ? totalKM * 0.60 : (500 * 0.60) + ((totalKM - 500) * 0.50);
        }

        // Makan Logic
        const gred = el('gred');
        const wilayah = el('wilayah').value;
        const baseMakan = parseFloat(gred.options[gred.selectedIndex].dataset.makan);

        let deduction = 0;
        if (el('makan_pagi').checked) deduction += 0.2;
        if (el('makan_tengahari').checked) deduction += 0.4;
        if (el('makan_malam').checked) deduction += 0.4;

        let elaunTotal = 0, labelElaun = "";
        if (diffHours >= 24) {
            const hari = Math.floor(diffHours / 24);
            elaunTotal = hari * (baseMakan * (1 - deduction));
            labelElaun = `${hari} Hari Makan`;
            if (diffHours % 24 > 8) { elaunTotal += (baseMakan / 2); labelElaun += " + Harian"; }
        } else if (diffHours > 8) {
            elaunTotal = baseMakan / 2;
            labelElaun = "Elaun Harian";
        } else { labelElaun = "Tiada Elaun"; }

        // Hotel/Lojing
        const bilMalam = parseInt(el('bil_malam').value) || 0;
        let kosHotelFinal = el('is_lojing').checked ? 100 * bilMalam : (parseFloat(el('hotel_kadar').value) || 0) * bilMalam;
        const tolVal = parseFloat(el('tol').value) || 0;
        
        // Update UI Result
        el('welcome_msg').classList.add('hidden');
        el('actual_result').classList.remove('hidden');
        
        el('res_nama_pegawai').innerText = el('nama').value || "PEGAWAI";
        el('res_ppd_info').innerText = el('ppd_org').value || "NEG. PAHANG";
        el('res_kod_program').innerText = "PROGRAM: " + (el('kod_program').value || "UMUM");
        el('res_km_stats').innerText = `${totalKM.toFixed(1)} KM (P-B)`;
        el('label_elaun').innerText = labelElaun;
        el('res_hotel_info').innerText = el('is_lojing').checked ? `Lojing (${bilMalam} Malam)` : `Hotel (${bilMalam} Malam)`;
        
        el('val_km').innerText = `RM ${kosKM.toFixed(2)}`;
        el('val_elaun').innerText = `RM ${elaunTotal.toFixed(2)}`;
        el('val_lain').innerText = `RM ${(kosHotelFinal + tolVal).toFixed(2)}`;
        const total = kosKM + elaunTotal + kosHotelFinal + tolVal;
        el('val_total').innerText = `RM ${total.toFixed(2)}`;

        currentData = {
            kodProgram: el('kod_program').value || "UMUM",
            nama: el('nama').value.toUpperCase(),
            ppd: el('ppd_org').value,
            perjalanan: `${(el('asal').value || "ASAL").toUpperCase()} ➔ ${(el('tujuan').value || "DESTINASI").toUpperCase()}`,
            mula: formatMasa(mula),
            tamat: formatMasa(tamat),
            jumlahKM: totalKM.toFixed(1),
            kosKM: kosKM.toFixed(2),
            elaunMakan: elaunTotal.toFixed(2),
            kosHotel: kosHotelFinal.toFixed(2),
            tol: tolVal.toFixed(2),
            jumlahBesar: total.toFixed(2)
        };
    }

    function simpanKeSheet() {
        if (!currentData) return;
        if (SCRIPT_URL.includes("MASUKKAN")) { alert("Sila kemaskini SCRIPT_URL dahulu."); return; }
        const btn = document.getElementById('btn_save');
        const status = document.getElementById('status_msg');
        btn.classList.add('btn-saving');
        status.classList.remove('hidden');

        fetch(SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(currentData)
        })
        .then(() => {
            alert("Berjaya dihantar ke Google Sheets!");
            btn.classList.remove('btn-saving');
            status.classList.add('hidden');
        })
        .catch(err => {
            alert("Ralat: " + err);
            btn.classList.remove('btn-saving');
            status.classList.add('hidden');
        });
    }
</script>
</body>
</html>
